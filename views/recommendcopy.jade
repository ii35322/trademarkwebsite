doctype html
//
  Spectral by HTML5 UP
  html5up.net | @ajlkn
  Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
html
  head
    title 商標通 - 最便捷的商標註冊服務
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    link(rel='stylesheet', type='text/css', href='https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.css')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.4/semantic.min.js')
    style.
      .ex1{
      }
      .ex2{
      }
  body
    div(style='margin:50px;')
      .ui.ordered.steps
        a.active.step
          .content
            .title 類別項目勾選
            .description 勾選您要申請商標所涵蓋的類別項目
        a.step
          .content
            .title 基本資料
            .description 填寫您的基本資料
        a.step
          .content
            .title 產生報告
            .description 以此報告可直接向智財局申請註冊
      p
      .ui.grid
        .four.wide.column
          h2.ui.header 要提交申請的項目
          #criteria(style='width:85%;margin:20px;')
            for i in [1,2,3]
              div(id="largelabel"+i).ui.hidden.blue.large.label
                | 香水瓶 #{i}
                i(id="deletelargelabel"+i).close.icon


        .six.wide.column
          .ui.big.left.lageled.input.search.ex1(style='width:100%;')
            input.prompt(type='text', placeholder='根據產品/服務篩選子類別',id='class-search-input')
            .results
            button#class-search-button.ui.large.teal.button(style='margin-left:10px;')
              | 搜尋
          
          p
          
          .ui.styled.accordion
            for c in class_list
              .title
                i.dropdown.icon
                |  #{c.name}
                //.ui.green.basic.label
                //  |  一般
              .content
                .accordion
                  for subclass in c.subclasses
                    if subclass_is_active[subclass.name]
                      .title.active
                        | #{subclass.name}
                    else
                      .title
                        | #{subclass.name}

                    if subclass_is_active[subclass.name]
                      .content.active
                        for item in subclass.items
                          
                          .ui.checkbox
                            input#showlargelabel(type='checkbox', name='example')
                            if item_is_active[item]
                              label(style='font-weight:bold;color:red')= item
                            else
                              label=item
                    else
                      .content
                        for item in subclass.items
                          
                          .ui.checkbox
                            input#showlargelabel(type='checkbox', name='example')
                            if item_is_active[item]
                              label(style='font-weight:bold;color:red')= item
                            else
                              label=item
                              
        .six.wide.column
          .ui.big.left.lageled.input.search(style='width:100%;')
            input.prompt(type='text', placeholder='以廠商名稱查詢註冊項目',id='profile-search-input')
            .results
            button#profile-search-button.ui.large.teal.button(style='margin-left:10px;')
              | 搜尋
          p
            for profile in profile_list
              .ui.styled.accordion
                .title
                  i.dropdown.icon
                  |  #{ (profile.en_name && profile.ch_name)? profile.ch_name+" ("+profile.en_name+")": ((profile.ch_name)?profile.ch_name:profile.en_name) }
                .content
                   for item in profile.items
                     .ui.checkbox
                        input(type='checkbox', name='example')
                        label #{item}
      .ui.right.floated.big.red.button 下一步
    
    script.
      
      profile_search_input="";
      class_search_input="";
      num_items = 3;

      //General Redirect
      function redirect(){
          
          var href = window.location.href;
          
          //parse href to url_suffix_map
          var href_arr = href.split("?");
          var domain_name = href_arr[0];
          
          var url_suffix = "";
          var url_suffix_map = {};
          
          if( href_arr.length > 1 ){
            url_suffix =  href_arr[1];
            if( url_suffix != "" ){
              url_suffix_arr = url_suffix.split("&");
              for(var i=0;i<url_suffix_arr.length;i++){
                 var token = url_suffix_arr[i];
                 kv_pair = token.split("=");
                 url_suffix_map[ kv_pair[0] ] = kv_pair[1];
              }
            }
          }
          
          //modify url_suffix_map
          if( class_search_input != "" )
            url_suffix_map['class_query'] = class_search_input;
          
          if( profile_search_input != "" )
            url_suffix_map['profile_query'] = profile_search_input;
          

          //reconstruct url_suffix from map
          var url_suffix_arr = [];
          for(key in url_suffix_map){
             var val = url_suffix_map[key];
             url_suffix_arr.push( key+"="+val );
          }
          url_suffix = url_suffix_arr.join("&");

          //redirect
          window.location.assign(domain_name+"?"+url_suffix);
      };
      
      //Class-based Search
      $('#class-search-button').click(function(){
      
          class_search_input = $('#class-search-input').val();
          redirect();
      });

      //Profile-based Search
      $('#profile-search-button').click(function(){

          profile_search_input = $('#profile-search-input').val();
          redirect();
      });

      //Product Select (Dis-selected)

      $('.ui.accordion').accordion();
      $('.activating.element').popup();

      for(var i=1;i<=num_items;i++){
      	(function(j){
      		$('#showlargelabel'+j).click( function(){ $('#largelabel'+j).transition('fade');  } );
      		$('#deletelargelabel'+j).click( function(){ $('#largelabel'+j).transition('fade'); } );
      	})(i);
      }

      //Class-based Autocomplete
      $('.ui.search.ex1').search({
      /*source: contex1'ent,
      fullTextSetting: false*/
        apiSettings: {
        url: "http://localhost:3000/search/?search_query={query}"
        //url: "https://api.github.com/search/repositories?q={query}"
      },
      fields: {
        results: 'items',
        title: 'name'
      },
        onResults: function(res) {
          console.log("res:", res)
        }
      });
